# GitHub Copilot カスタマイズ機能の調査

調査日: 2025 年 11 月 11 日

## 概要

GitHub Copilot には、組織やプロジェクト固有のコーディング規約やワークフローに合わせて AI の振る舞いをカスタマイズする 4 つの主要な仕組みがあります。

## 1. カスタムインストラクション (Custom Instructions)

### 1.1 リポジトリ全体への指示 (Repository-wide Instructions)

**ファイル**: `.github/copilot-instructions.md`

**目的**: リポジトリ全体のコンテキストで適用される自然言語の指示を定義

**例**:

```markdown
# Project Overview

This project is a web application that allows users to manage their tasks and to-do lists.

## Libraries and Frameworks

- React and Tailwind CSS for the frontend.
- Node.js and Express for the backend.
- MongoDB for data storage.

## Coding Standards

- Use semicolons at the end of each statement.
- Use single quotes for strings.
- Use function based components in React.
- Use arrow functions for callbacks.
```

**特徴**:

- すべての Copilot リクエストに自動的に適用される
- Markdown 形式で記述
- プロジェクト構造、ライブラリ、コーディング規約などを記述

### 1.2 パス固有の指示 (Path-specific Instructions)

**ファイル**: `.github/instructions/*.instructions.md`

**目的**: 特定のファイルパターンやディレクトリに適用される指示を定義

**構造**:

```markdown
---
applyTo: "app/models/**/*.rb"
---

# Model Instructions

These instructions apply specifically to Ruby model files within the `app/models` directory.
```

**Glob パターンの例**:

- `app/models/**/*.rb` - 特定ディレクトリ内の特定拡張子
- `**/*.ts,**/*.tsx` - 複数の拡張子
- `**` - すべてのファイル

**利点**:

- ファイルタイプごとに異なる規約を適用可能
- フロントエンド/バックエンドで異なる指示を設定可能

### 1.3 VS Code 設定による指示 (Settings-based Instructions)

**ファイル**: `.vscode/settings.json`

**設定項目**:

```json
{
  "github.copilot.chat.codeGeneration.instructions": [
    {
      "text": "Always add a comment: 'Generated by Copilot'."
    },
    {
      "text": "In TypeScript always use underscore for private field names."
    },
    {
      "file": "general.instructions.md"
    }
  ],
  "github.copilot.chat.testGeneration.instructions": [],
  "github.copilot.chat.commitMessageGeneration.instructions": [],
  "github.copilot.chat.pullRequestDescriptionGeneration.instructions": []
}
```

**適用可能な指示タイプ**:

- `codeGeneration.instructions` - コード生成
- `testGeneration.instructions` - テスト生成
- `commitMessageGeneration.instructions` - コミットメッセージ生成
- `pullRequestDescriptionGeneration.instructions` - PR 説明生成
- `reviewSelection.instructions` - コードレビュー

### 1.4 エージェント指示 (Agent Instructions)

**ファイル**: `AGENTS.md`, `CLAUDE.md`, または `GEMINI.md`

**目的**: AI エージェント（Copilot Chat 内のエージェントモード）用の指示

**例**:

```markdown
# Agent Instructions

- Act as a senior software engineer.
- Provide clear explanations for code suggestions.
- Ask clarifying questions if the request is ambiguous.
- Focus on security best practices.
```

**配置場所**:

- VS Code: ワークスペースルート
- その他: リポジトリ内の任意の場所（最も近い`AGENTS.md`が優先）

## 2. カスタムチャットモード (Custom Chat Modes)

### 概要

カスタムチャットモードは、特定のタスクやワークフローに特化した Copilot Chat の動作モードを定義します。

**ファイル**: `*.mode.md`

**設定有効化**:

```json
{
  "chat.modeFilesLocations": {
    ".copilot/modes": true
  }
}
```

### 構造例

```markdown
---
description: Generate an implementation plan for new features or refactoring existing code.
tools: ["codebase", "fetch", "findTestFiles", "githubRepo", "search", "usages"]
---

# Planning mode instructions

You are in planning mode. Your task is to generate an implementation plan.
Don't make any code edits, just generate a plan.

The plan consists of a Markdown document that describes:

- Overview: A brief description of the feature or refactoring task.
- Requirements: A list of requirements.
- Implementation Steps: A detailed list of steps.
- Testing: A list of tests needed.
```

**特徴**:

- `description`: モードの説明
- `tools`: 使用可能なツールのリスト
- モード固有の指示とプロンプト

**使用例**:

- Planning Mode - 実装計画の作成
- Review Mode - コードレビュー専用
- Debug Mode - デバッグ支援
- Documentation Mode - ドキュメント生成

**切り替え**: `⌘.` (Mac) / `Ctrl+.` (Windows/Linux)

## 3. 再利用可能なプロンプト (Reusable Prompts)

### 概要

繰り返し使用するプロンプトをファイルとして保存し、必要に応じて呼び出せる仕組み。

**ファイル**: `*.prompt.md`

**設定有効化**:

```json
{
  "chat.promptFiles": true,
  "chat.promptFilesLocations": {
    ".copilot/prompts": true
  }
}
```

### 構造例

```markdown
---
description: Add educational comments to code
variables:
  - name: COMMENT_DETAIL
    type: number
    default: 3
    description: Level of detail (1-5)
  - name: REPETITIVENESS
    type: number
    default: 3
    description: How repetitive comments should be (1-5)
  - name: LINE_NUMBER
    type: boolean
    default: true
    description: Reference line numbers in comments
---

Add educational comments to the selected code.

Comment Detail Level: ${COMMENT_DETAIL}
Repetitiveness: ${REPETITIVENESS}
Include Line Numbers: ${LINE_NUMBER}

Focus on:

- Explaining the purpose of complex logic
- Documenting edge cases
- Clarifying non-obvious decisions
```

**特徴**:

- 変数のカスタマイズが可能
- デフォルト値を設定可能
- 説明文を含めることができる

**使用方法**:

1. チャットビューで "Prompts..." ボタンをクリック
2. プロンプトを選択
3. 変数をカスタマイズ（必要に応じて）
4. 実行

**ユースケース**:

- コードレビューテンプレート
- テスト生成パターン
- リファクタリング指示
- ドキュメント生成テンプレート
- マイグレーション指示

## 4. スラッシュコマンド (Slash Commands)

### 概要

Copilot Chat で使用できる組み込みコマンド。複雑なプロンプトを短いコマンドで実行可能。

### 標準コマンド（VS Code）

| コマンド          | 説明                                       |
| ----------------- | ------------------------------------------ |
| `/clear`          | 新しいチャットセッションを開始             |
| `/explain`        | アクティブエディタのコードの動作を説明     |
| `/fix`            | 選択したコードの問題を修正する提案         |
| `/tests`          | 選択したコードの単体テストを生成           |
| `/help`           | Copilot の使用方法のクイックリファレンス   |
| `/new`            | 新しいプロジェクトを作成                   |
| `/newNotebook`    | 新しい Jupyter notebook を生成             |
| `/docs`           | 関数やメソッドのドキュメントコメントを生成 |
| `/fixTestFailure` | 失敗したテストを見つけて修正               |
| `/startDebugging` | デバッグ設定を生成してセッションを開始     |

### チャットパーティシパント（@-mentions）

特定の専門知識を持つパーティシパントにクエリを送信:

| パーティシパント | 目的                                   |
| ---------------- | -------------------------------------- |
| `@workspace`     | ワークスペース全体を対象としたクエリ   |
| `@vscode`        | VS Code 機能や設定に関する質問         |
| `@terminal`      | ターミナルコマンドやシェルに関する質問 |
| `@github`        | GitHub 操作（issues, PRs, 検索）       |

**例**:

```
@workspace どこでデータベース接続文字列が定義されていますか？
@terminal 最後の3つのコミットを取り消す方法は？
@vscode ワードラップを有効にする方法は？
@github #githubRepo microsoft/vscode TypeScriptと一貫性があるかコードレビュー
```

### パーティシパント固有コマンド

**@vscode**:

- `/runCommand` - VS Code コマンドを実行
- `/search` - VS Code 検索を生成

**@terminal**:

- `/explain` - ターミナル出力やコマンドを説明

### チャット変数（#-mentions）

コンテキストをプロンプトに追加:

| 変数                   | 説明                             |
| ---------------------- | -------------------------------- |
| `#file`                | 特定のファイルを参照             |
| `#selection`           | 現在のエディタ選択範囲           |
| `#codebase`            | ワークスペース全体のコンテキスト |
| `#changes`             | ソース管理の変更リスト           |
| `#problems`            | Problems パネルの問題            |
| `#terminalSelection`   | ターミナルの選択範囲             |
| `#terminalLastCommand` | 最後に実行したターミナルコマンド |
| `#githubRepo`          | GitHub リポジトリのコード検索    |
| `#testFailure`         | テスト失敗情報                   |

**例**:

```
#selection のバグを修正して
#codebase でルーティングの実装方法は？
#changes の変更をまとめて
#githubRepo vercel/next.js Next.jsでルーティングはどう機能する？
```

### MCP（Model Context Protocol）ツール

外部サービスとの統合:

```json
{
  "chat.mcp.enabled": true
}
```

**使用例**:

```
私のオープンな問題は何ですか #github-mcp
#postgres から会社名の最大長は？
issue #123 の修正を実装して #github-mcp
```

## 5. VS Code 設定オプション

### 主要設定

```json
{
  // 一般設定
  "github.copilot.editor.enableCodeActions": true,
  "github.copilot.renameSuggestions.triggerAutomatically": true,
  "chat.commandCenter.enabled": true,

  // コード補完設定
  "github.copilot.enable": {
    "*": true,
    "yaml": false,
    "plaintext": false
  },
  "github.copilot.nextEditSuggestions.enabled": true,

  // チャット設定
  "github.copilot.chat.followUps": "on",
  "github.copilot.chat.localeOverride": "ja",
  "github.copilot.chat.runCommand.enabled": true,
  "github.copilot.chat.useProjectTemplates": true,
  "chat.detectParticipant.enabled": true,

  // エージェントモード設定
  "chat.agent.enabled": true,
  "chat.agent.maxRequests": 15,
  "github.copilot.chat.agent.autoFix": true,
  "github.copilot.chat.agent.runTasks": true,

  // 実験的機能
  "chat.implicitContext.enabled": true,
  "github.copilot.chat.codesearch.enabled": true,
  "github.copilot.chat.edits.temporalContext.enabled": true,

  // インストラクションファイルの場所
  "chat.instructionsFilesLocations": {
    ".github/instructions": true
  },
  "chat.promptFilesLocations": {
    ".copilot/prompts": true
  },
  "chat.modeFilesLocations": {
    ".copilot/modes": true
  }
}
```

### 特殊な設定

**コードレビュー**:

```json
{
  "github.copilot.chat.reviewSelection.enabled": true,
  "github.copilot.chat.reviewSelection.instructions": [
    {
      "text": "Focus on security vulnerabilities and performance issues."
    }
  ]
}
```

**デバッグ**:

```json
{
  "github.copilot.chat.startDebugging.enabled": true,
  "github.copilot.chat.copilotDebugCommand.enabled": true
}
```

## 6. キーボードショートカット

### VS Code

| ショートカット                                 | 説明                           |
| ---------------------------------------------- | ------------------------------ |
| `Ctrl+Alt+I` (Win/Linux)<br>`⌃⌘I` (Mac)        | チャットビューを開く           |
| `Ctrl+Shift+Alt+L` (Win/Linux)<br>`⇧⌥⌘L` (Mac) | クイックチャットを開く         |
| `Ctrl+I` (Win/Linux)<br>`⌘I` (Mac)             | インラインチャットを開始       |
| `Ctrl+.` (Win/Linux)<br>`⌘.` (Mac)             | チャットモードを切り替え       |
| `Tab`                                          | 提案を受け入れる               |
| `Alt+]`                                        | 次の提案                       |
| `Alt+[`                                        | 前の提案                       |
| `Ctrl+→` (Win/Linux)<br>`⌘→` (Mac)             | 単語単位で受け入れる           |
| `Ctrl+↓` (Win/Linux)<br>`⌘↓` (Mac)             | 行単位で受け入れる             |
| `F2`                                           | シンボルのリネーム時に AI 提案 |

## 7. ベストプラクティス

### 効果的なカスタムインストラクションの書き方

**DO**:

```markdown
## Naming Conventions

- Use PascalCase for component names, interfaces, and type aliases
- Use camelCase for variables, functions, and methods
- Prefix private class members with underscore (\_)
- Use ALL_CAPS for constants

## Error Handling

- Use try/catch blocks for async operations
- Implement proper error boundaries in React components
- Always log errors with contextual information
```

**DON'T**:

```markdown
Always conform to the coding styles defined in styleguide.md in repo my-org/my-repo.
Answer all questions in the style of a friendly colleague.
Answer all questions in less than 1000 characters.
```

### 推奨構成

**小規模プロジェクト**:

- `.github/copilot-instructions.md` のみ

**中規模プロジェクト**:

- `.github/copilot-instructions.md` (全体)
- `.github/instructions/frontend.instructions.md` (フロントエンド固有)
- `.github/instructions/backend.instructions.md` (バックエンド固有)

**大規模プロジェクト**:

- リポジトリ全体の指示
- 複数のパス固有指示
- カスタムチャットモード
- 再利用可能なプロンプト
- エージェント指示

### ファイル構造の例

```
project/
├── .github/
│   ├── copilot-instructions.md          # リポジトリ全体
│   └── instructions/
│       ├── frontend.instructions.md      # フロントエンド
│       ├── backend.instructions.md       # バックエンド
│       └── testing.instructions.md       # テスト
├── .copilot/
│   ├── modes/
│   │   ├── planning.mode.md             # プランニングモード
│   │   └── review.mode.md               # レビューモード
│   └── prompts/
│       ├── code-review.prompt.md        # コードレビュー
│       └── test-generation.prompt.md    # テスト生成
├── .vscode/
│   └── settings.json                     # VS Code設定
└── AGENTS.md                             # エージェント指示
```

## 8. カスタマイズの優先順位

カスタムインストラクションが重複する場合の適用順序:

1. **VS Code 設定** (`settings.json`) - 最も具体的
2. **パス固有の指示** (`.github/instructions/*.instructions.md`) - 近いファイルが優先
3. **エージェント指示** (`AGENTS.md`, `CLAUDE.md`, `GEMINI.md`) - 近いファイルが優先
4. **リポジトリ全体の指示** (`.github/copilot-instructions.md`) - 最も一般的

## 9. 実験的機能

### エージェントモード

```json
{
  "chat.agent.enabled": true,
  "chat.agent.maxRequests": 15,
  "github.copilot.chat.agent.autoFix": true,
  "github.copilot.chat.agent.runTasks": true,
  "github.copilot.chat.agent.thinkingTool": true
}
```

**特徴**:

- 自律的なタスク実行
- 複数のリクエストを自動実行（最大 15 回）
- 生成されたコードの自動診断と修正
- ワークスペースタスクの自動実行

### Copilot Edits

```json
{
  "github.copilot.chat.edits.temporalContext.enabled": true,
  "github.copilot.chat.edits.suggestRelatedFilesFromGitHistory": true,
  "chat.editing.autoAcceptDelay": 0
}
```

**特徴**:

- 最近閲覧・編集したファイルを自動的にコンテキストに含める
- Git 履歴から関連ファイルを提案
- 編集の自動承認（遅延設定可能）

### Model Context Protocol (MCP)

```json
{
  "chat.mcp.enabled": true
}
```

**特徴**:

- 外部ツールやサービスとの統合
- カスタムツールの追加
- データベース、API、外部サービスへのアクセス

## 10. まとめ

### 機能比較表

| 機能                           | ファイル                                 | 範囲               | 用途                                 |
| ------------------------------ | ---------------------------------------- | ------------------ | ------------------------------------ |
| **カスタムインストラクション** | `.github/copilot-instructions.md`        | リポジトリ全体     | 全般的なコーディング規約             |
| **パス固有インストラクション** | `.github/instructions/*.instructions.md` | 特定パス           | ファイルタイプ別の規約               |
| **VS Code 設定**               | `.vscode/settings.json`                  | ワークスペース     | タスク別（テスト、レビュー等）の指示 |
| **エージェント指示**           | `AGENTS.md`                              | コンテキスト依存   | エージェントモード専用               |
| **カスタムモード**             | `*.mode.md`                              | チャットセッション | 特定のワークフロー                   |
| **プロンプトファイル**         | `*.prompt.md`                            | オンデマンド       | 再利用可能なテンプレート             |
| **スラッシュコマンド**         | 組み込み                                 | チャット           | クイックアクション                   |

### 推奨される使い分け

1. **コーディング規約** → カスタムインストラクション
2. **言語/フレームワーク固有のルール** → パス固有インストラクション
3. **特定のタスク（テスト、レビュー）** → VS Code 設定 + プロンプトファイル
4. **ワークフロー（計画、実装、レビュー）** → カスタムモード
5. **エージェント動作** → エージェント指示
6. **一般的な質問やアクション** → スラッシュコマンド + チャットパーティシパント

### 参考リンク

- [VS Code Copilot Customization Documentation](https://code.visualstudio.com/docs/copilot/copilot-customization)
- [GitHub Copilot Custom Instructions](https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot)
- [Awesome Copilot (Community Resources)](https://github.com/github/awesome-copilot)
