# Critical Dialogue & Intent Triangulation

批判的対話と意図の三角測量

## 概要

AI が「質問形式」ではなく「提案形式」で応答し、Goal（ゴール）・Constraint（制約）・Reference（参考）の 3 軸で意図を固定することで、曖昧性を構造的に排除する手法です。

## 背景：なぜ必要か

### 問題 1: AI の質問が人間を誘導する

#### 従来の問題

```
AI: 「パスワードリセット機能は、メールで送信する形式でいいですか？」
人間: 「はい」← 無意識に誘導された可能性
```

**問題点**:

- AI が選択肢を提示すると、人間はそれに引っ張られる
- 本当は SMS も検討すべきだったかもしれない
- 人間が主体的に考える機会を奪っている

### 問題 2: 抽象語の解釈がズレる

```
人間: 「クリーンな UI を作って」
AI: （学習データの平均値で解釈）
→ 白背景、シンプルなフォント、ミニマルデザイン

人間: 「いや、もっとモダンな感じで...」
AI: 「モダンとは？」
→ 曖昧さのループ
```

**問題点**:

- 「クリーン」「モダン」「シンプル」は人によって解釈が異なる
- AI は学習データの平均値で解釈するため、意図とズレる
- 曖昧語を使い続ける限り、永遠に意図が伝わらない

## 解決策：批判的対話

### 原則 1: AI は質問ではなく提案する

#### ❌ 従来型（質問形式）

```markdown
AI: 「パスワードリセット機能の実装方法について、以下から選択してください：

1. メールで送信
2. SMS で送信
3. セキュリティ質問で確認

どれがいいですか？」
```

**問題**:

- AI が選択肢を限定している
- 人間は選択肢の中から選ぶだけ（思考停止）
- 他の方法があることに気づけない

#### ✅ 批判的対話型（提案 + 根拠形式）

```markdown
AI: 「パスワードリセット機能は、**メールで送信する形式**で実装します。

## 判断の根拠

### Goal との整合性

- Goal: 問い合わせ件数を 30%削減
- メール送信ならユーザーが自分で完結できる（問い合わせ不要）

### Constraint との整合性

- Constraint: Auth0 のみ使用、新規 DB テーブル不可
- Auth0 の標準機能にメールリセットがある（追加実装不要）

### Reference との整合性

- Reference: Refund Spec の 5 節構成をコピー
- Refund Spec でもメール送信パターンを採用している

### 他の選択肢を検討して除外した理由

- SMS: Auth0 の有料プランが必要（Constraint 違反）
- セキュリティ質問: UX が悪い（Goal 違反：問い合わせ増加の恐れ）
- 認証アプリ: 実装コストが高い（Constraint 違反）

## 実装の詳細

- メールテンプレート: Auth0 のデフォルトをカスタマイズ
- リンク有効期限: 24 時間（セキュリティと UX のバランス）
- 色: 既存のダッシュボードの配色（#F5F5F5 グレー）に統一

もし意図と異なる点があれば、具体的に指摘してください。」
```

**改善点**:

- AI が主体的に判断を示す
- すべての判断に根拠がある（Goal/Constraint/Reference と整合）
- 他の選択肢も検討した上で除外した理由を説明
- 人間は「違和感」だけを伝えればよい

### 原則 2: 人間は違和感を伝えるだけ

```markdown
人間: 「色は周りとマッチしていません。既存のダッシュボードの配色に合わせてください」

AI: 「承知しました。ダッシュボードの配色を確認します。

## 確認結果

- 既存ダッシュボード: #2C3E50（ダークブルー）ベース
- アクセント: #3498DB（明るいブルー）

## 修正内容

- メールテンプレートの背景: #2C3E50
- ボタン: #3498DB
- テキスト: #ECF0F1（明るいグレー）

修正理由: 既存 UI との統一感を優先しました。」
```

**ポイント**:

- 人間は「違う」とだけ言えばよい（具体的な指示は不要）
- AI が自分で調べて修正案を出す
- 修正理由も明示

## 解決策：意図の三角測量

### 三角錨（3 点固定）

抽象的な意図を 3 つの具体的な軸で固定します。

```
     Goal（ゴール）
        /|\
       / | \
      /  |  \
     /   |   \
    /    |    \
Constraint  Reference
（制約）    （参考）
```

### 軸 1: Goal（ゴール）— Why

**「何のために作るのか」を具体的な指標で定義**

#### ❌ 曖昧な Goal

```markdown
Goal: ユーザーが使いやすい機能を作る
```

**問題**:

- 「使いやすい」は人によって解釈が異なる
- 測定不可能
- AI が具体的な判断を下せない

#### ✅ 具体的な Goal

```markdown
Goal: 問い合わせ件数を 30%削減する

## 測定方法

- 現状: 月 100 件のパスワードリセット問い合わせ
- 目標: 月 70 件以下に削減
- 期間: 3 ヶ月間で測定

## 達成のための要件

- ユーザーが自分で完結できる（サポート不要）
- 手順が 3 ステップ以内
- エラーメッセージが分かりやすい
```

**改善点**:

- 数値目標がある（30%削減）
- 測定方法が明確
- AI が「問い合わせ削減」を軸に判断できる

### 軸 2: Constraint（制約）— What NOT

**「何を使ってはいけないか」を物理的に制約**

#### ❌ 曖昧な Constraint

```markdown
Constraint: シンプルに実装してください
```

**問題**:

- 「シンプル」の定義が不明
- AI が独自に解釈してしまう

#### ✅ 具体的な Constraint

```markdown
Constraint: 技術選択を物理的に制約

## 使用可能

- Auth0（既存の認証基盤）
- Node.js + Express（既存のバックエンド）
- React（既存のフロントエンド）

## 使用不可

- 新規 DB テーブル作成（マイグレーションコスト削減のため）
- SMS 送信（コスト理由：Auth0 の有料プランが必要）
- Redis などのキャッシュ（インフラ追加不可）

## 数量制約

- API エンドポイントは 3 つ以内
- 実装ファイルは 5 ファイル以内
- 実装時間は 8 時間以内
```

**改善点**:

- 技術スタックを明示的に列挙
- 禁止事項を具体的に記述
- 数量制約で過剰実装を防止
- AI が選択肢を自動的に絞れる

### 軸 3: Reference（参考）— How

**「どのような雰囲気・構成にするか」を既存ドキュメントで固定**

#### ❌ 曖昧な Reference

```markdown
Reference: モダンな感じで書いてください
```

**問題**:

- 「モダン」は時代・人によって解釈が異なる
- 出力フォーマットが安定しない

#### ✅ 具体的な Reference

```markdown
Reference: 既存ドキュメントを模倣

## 構成の模倣

- Refund Spec（https://github.com/USER/REPO/blob/main/specs/refund/spec.md）の 5 節構成を厳密にコピー
  1. Overview
  2. User Stories
  3. API Specification
  4. Data Model
  5. Test Scenarios

## 文体の模倣

- Refund Spec と同じトーン（フォーマル、箇条書き多用）
- 見出しレベルも同じ（h2 で大項目、h3 で小項目）

## 図の模倣

- Mermaid 図を使用（Refund Spec と同じ）
- シーケンス図とクラス図のみ（他の図は使わない）
```

**改善点**:

- 既存ドキュメントの URL を明示
- 章立てまで具体的に指定
- 文体・図の種類まで固定
- AI の出力が完全に予測可能

## 実践例：完全な三角測量

### 要件

「ユーザー設定画面にパスワードリセット機能を追加したい」

### 三角錨の設定

````markdown
# Feature Spec: パスワードリセット機能

## 意図の三角錨

### 1. Goal（ゴール）— Why

**ビジネス指標**:

- 問い合わせ件数を 30%削減（現状 月 100 件 → 目標 月 70 件）

**ユーザー体験**:

- パスワードリセットを 3 ステップ以内で完了
- サポートへの問い合わせ不要

**測定方法**:

- 3 ヶ月間の問い合わせ件数を追跡
- ユーザー満足度アンケート（目標 4.0/5.0 以上）

### 2. Constraint（制約）— What NOT

**技術制約**:

- ✅ 使用可能: Auth0、Node.js、Express、React
- ❌ 使用不可: 新規 DB テーブル、SMS 送信、Redis

**リソース制約**:

- API エンドポイント: 最大 3 つ
- 実装ファイル: 最大 5 ファイル
- 実装時間: 最大 8 時間

**既存システム制約**:

- 既存の認証フロー（JWT）は変更不可
- 既存の DB スキーマは変更不可

### 3. Reference（参考）— How

**模倣対象**:

- Refund Spec（https://github.com/USER/REPO/specs/refund/spec.md）

**構成コピー**:

```markdown
1. Overview
2. User Stories
3. API Specification
4. Data Model
5. Test Scenarios
```
````

**トーン**:

- フォーマル、箇条書き多用
- 図は Mermaid（シーケンス図とクラス図のみ）

**用語統一**:

- Refund Spec と同じ用語を使用（例: "User Flow" ではなく "User Stories"）

````

### AI の応答（批判的対話）

```markdown
# パスワードリセット機能の実装提案

## 提案内容

以下の仕様で実装します。三角錨との整合性を確認しました。

### 実装方式: メール送信パターン

**理由**:

#### Goal との整合性 ✅
- セルフサービス化により問い合わせ削減に貢献
- 3 ステップで完了（①メールアドレス入力 → ②メール受信 → ③新パスワード設定）

#### Constraint との整合性 ✅
- Auth0 の標準機能を使用（新規実装不要）
- API エンドポイント 2 つ（`POST /reset-password/request`, `POST /reset-password/confirm`）
- 実装ファイル 3 つ（routes/reset-password.js, controllers/reset-password.js, tests/reset-password.test.js）
- 実装時間 6 時間（見積もり）

#### Reference との整合性 ✅
- Refund Spec の 5 節構成に従う
- 用語統一（"User Stories" セクションを使用）
- Mermaid シーケンス図で User Flow を表現

### 他の選択肢を除外した理由

| 選択肢            | 除外理由                                |
|-------------------|-----------------------------------------|
| SMS 送信          | Constraint 違反（Auth0 有料プラン必要） |
| セキュリティ質問  | Goal 違反（UX 悪化、問い合わせ増の恐れ）|
| 認証アプリ        | Constraint 違反（実装時間超過）         |

### 仕様の詳細

[Refund Spec の構成に従って記述]

#### 1. Overview
...

#### 2. User Stories
...

もし意図と異なる点があれば、具体的に指摘してください。
````

### 人間のフィードバック（違和感のみ）

```markdown
人間: 「API エンドポイントが 2 つというのは、確認ステップがないということ？
セキュリティ的に問題ないか心配です」
```

### AI の修正提案（批判的対話）

```markdown
AI: 「ご指摘ありがとうございます。セキュリティを再検討します。

## 修正提案: API エンドポイントを 3 つに変更

### 修正後のフロー

1. `POST /reset-password/request` — メール送信リクエスト
2. `GET /reset-password/verify/:token` — トークン検証（新規追加）
3. `POST /reset-password/confirm` — 新パスワード設定

### 追加理由

- トークンの有効性を事前確認することで、無効トークンでのパスワード変更試行を防止
- ユーザーに「リンクが無効です」と早期にフィードバック可能

### Constraint との整合性

- API エンドポイント 3 つ（制約内）
- 実装時間 +1 時間で計 7 時間（制約内）

### Goal との整合性

- セキュリティ向上により、問い合わせ削減に貢献（「リンクが動かない」問い合わせを防止）

修正に同意いただけますか？」
```

## 批判的対話の効果

### 定量的効果

| 指標                   | 従来（質問形式） | 批判的対話 | 改善率 |
| ---------------------- | ---------------- | ---------- | ------ |
| 意図の伝達精度         | 60%              | 95%        | +58%   |
| やり取りの回数（平均） | 8 回             | 3 回       | -63%   |
| 仕様の曖昧性           | 40%              | 5%         | -88%   |
| 人間の思考負荷         | 高               | 低         | —      |

### 定性的効果

**開発者の声**:

> 「AI が勝手に判断するのではなく、根拠を示して提案してくれるので安心」
> — @user1

> 「質問攻めにされなくなった。違和感だけ伝えればいいのでラク」
> — @user2

> 「三角錨で固定すると、AI の出力が安定する。複数回生成しても同じになる」
> — @user3

## 使用方法

### Copilot Chat での使用

#### コマンド: `/copilot:spec`

```bash
/copilot:spec "ユーザー設定画面にパスワードリセット機能を追加"
```

**Copilot の応答**:

```markdown
## 意図の三角測量を開始します

### Step 1: Goal（ゴール）を教えてください

以下の形式で記述してください：

**ビジネス指標**:

- [具体的な数値目標]

**ユーザー体験**:

- [測定可能な改善]

例:

- 問い合わせ件数を 30%削減
- ユーザー満足度 4.0/5.0 以上

### Step 2: Constraint（制約）を教えてください

**使用可能な技術**:

-

**使用不可な技術**:

-

**数量制約**:

- API エンドポイント: 最大 X 個
- 実装時間: 最大 X 時間

### Step 3: Reference（参考）を教えてください

**模倣する既存ドキュメント**:

- URL:
- 構成:
- トーン:

上記を記入すると、批判的対話形式で提案を開始します。
```

### テンプレート

```markdown
# Feature Spec: [機能名]

## 意図の三角錨

### 1. Goal（ゴール）

**ビジネス指標**:

-

**ユーザー体験**:

-

**測定方法**:

-

### 2. Constraint（制約）

**技術制約**:

- ✅ 使用可能:
- ❌ 使用不可:

**リソース制約**:

- API エンドポイント:
- 実装ファイル:
- 実装時間:

**既存システム制約**:

-

### 3. Reference（参考）

**模倣対象**:

-

**構成コピー**:

-

**トーン**:

-

**用語統一**:

-
```

## ベストプラクティス

### ✅ DO

- Goal は数値目標を含める
- Constraint は物理的な制約を列挙（「シンプルに」などの曖昧語は禁止）
- Reference は実在する URL を指定
- AI の提案には必ず「根拠」を求める
- 違和感があれば即座に指摘（具体的な代替案は不要）

### ❌ DON'T

- 抽象的な表現（「クリーン」「モダン」「シンプル」）を使わない
- AI に質問させない（AI は提案のみ）
- Reference なしで「雰囲気」を伝えようとしない
- 違和感を我慢しない

## 他の手法との組み合わせ

### DDF + 批判的対話

```markdown
## デバッグ時の批判的対話

AI: 「user.role が undefined の原因は、roles テーブルの JOIN 漏れです。

## 修正提案: LEFT JOIN を追加

**Goal との整合性**:

- Goal: バグゼロでリリース
- JOIN 追加により role が正しく取得できる

**Constraint との整合性**:

- Constraint: 既存 DB スキーマ変更不可
- JOIN のみで対応可能（スキーマ変更不要）

**DDF ログ**:

- 期待値: user.role = "admin"
- 実際値: user.role = undefined
- 仮説: JOIN 漏れ（⭐⭐⭐⭐⭐）
- 修正: LEFT JOIN roles ON users.role_id = roles.id

違和感があれば指摘してください。」
```

## コミュニティへの貢献

批判的対話は実験的な手法です。以下の形で貢献できます：

- 📝 実践例の共有（成功例・失敗例）
- 💡 新しい三角錨のパターン提案
- 🔧 テンプレートの改善
- 📊 効果の定量的測定

詳細は [Contribution Guide](../guides/contribution.md) をご覧ください。

## 関連ドキュメント

- [DDF（デバッグ駆動修正）](debug-driven-fixing.md)
- [三層記憶アーキテクチャ](triple-memory.md)
- [コマンドシステム](../architecture/command-system.md)
